# ğŸ“Œ Project PRD: Instagram DM Concierge â€” MCP + Claude + FastAPI Backend + Loveable Frontend

## ğŸ§  Goal:
Build a backend system that:
- Connects to the Gala Labs MCP (https://github.com/trypeggy/instagram_dm_mcp)
- Polls and replies to DMs using Claude Desktop as agent
- Uses FastAPI to serve:
  - Editable DM templates
  - Basic dashboard stats
  - Target user management
- Connects to a lightweight React (Vite + Tailwind) frontend built with Loveable (no-auth, local only)

---

## âœ… Features

### 1. Real-Time DM Bot Behavior (via Claude Desktop)
- Poll `list_chats` every 2â€“5 mins
- For each new message in `list_messages`:
  - Classify intent with rule-based logic (no external LLMs)
  - Match with appropriate template
  - `mark_message_seen`
  - `send_message`
  - Log metadata (thread, user, time, category)

### 2. Backend API (Python + FastAPI)
| Endpoint | Method | Description |
|----------|--------|-------------|
| `/stats` | GET    | Returns metrics: messages processed, response time avg, unresolved |
| `/templates` | GET/POST/PUT/DELETE | CRUD for response templates stored in JSON |
| `/targets` | GET/POST | Add or view users being tracked |
| `/log` | GET | Retrieve full interaction log |
| `/ping` | GET | Health check for dashboard |

### 3. Frontend Dashboard (Loveable export â†’ Vite+Tailwind)
- Sidebar with: Inbox, Templates, Targets, Stats
- DM Templates UI: Add/Edit tags, categories, text
- Stats Cards: Responses sent, pending, avg latency
- Minimal clean layout (award-winning style prompt used)
- Connects to above APIs (local only)

---

## ğŸ“ File Structure

project/
â”œâ”€â”€ main.py # FastAPI server entry
â”œâ”€â”€ tasks/
â”‚ â””â”€â”€ dm_poller.py # Polling logic
â”œâ”€â”€ api/
â”‚ â””â”€â”€ routes.py # API endpoints
â”œâ”€â”€ data/
â”‚ â”œâ”€â”€ templates.json # DM templates
â”‚ â”œâ”€â”€ targets.json # User targets
â”‚ â””â”€â”€ log.json # Interaction log
â”œâ”€â”€ utils/
â”‚ â””â”€â”€ mcp_client.py # Wrapper around Gala MCP tools
â”œâ”€â”€ frontend/ # Output from Loveable (Vite+Tailwind build)
â”‚ â””â”€â”€ index.html
â”œâ”€â”€ .env
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md

yaml
Copy
Edit

---

## ğŸ”Œ Claude Desktop MCP Integration

- Uses `uv` to launch: `uv run --directory ./ instagram_dm_mcp/src/mcp_server.py`
- Configured in `~/.cursor/mcp.json` or Claude config for tool interface
- All MCP commands (`list_chats`, `send_message`, etc.) wrapped in `mcp_client.py`

---

## ğŸ’¡ Example Workflow

1. User adds DM templates via frontend (stored in `templates.json`)
2. User adds usernames in Targets tab
3. Poller fetches new DMs from those targets
4. If message matches intent:
   - Message marked as seen
   - Template used to respond
   - Log is updated
5. Stats are updated in backend and fetched by dashboard

---

## ğŸš« Constraints
- No third-party APIs
- No database (use JSON file stores)
- All local, single user setup
- Keep everything bug-free and clean

## ğŸ§ª Deliverables
- FastAPI backend with running endpoints
- Claude Desktop MCP automation working with real messages
- Loveable-exported dashboard, styled and API-ready